# Swifty Companion

A React Native mobile application for browsing 42 school student profiles.

## Features

- OAuth authentication with 42 API
- Profile search by login
- Display detailed information (email, wallet, correction points, etc.)
- Skill visualization with levels and percentages
- List of completed and failed projects
- Smooth navigation between pages
- Error handling (login not found, network errors, etc.)
- Responsive and modern design

## Prerequisites

- Node.js (v18 or higher)
- npm or yarn
- Expo CLI
- A 42 account with a configured OAuth application

## Installation

### 1. Clone the project

```bash
git clone <repo-url>
cd ft-swifty-companion
```

### 2. Install dependencies

```bash
npm install
```

### 3. Configure the 42 OAuth application

1. Go to [https://profile.intra.42.fr/oauth/applications](https://profile.intra.42.fr/oauth/applications)
2. Create a new application or edit an existing one
3. Configure the following **Redirect URIs** (to support all environments):
   ```
   swiftycompanion://redirect
   exp://localhost:8081/--/redirect
   http://localhost:8081
   https://auth.expo.io/@your-username/swifty-companion
   ```
   **Important:** Replace `your-username` with your Expo username for the last URI (required for tunnel mode on 42 network)
4. Note your `Client ID` and `Client Secret`

### 4. Configure environment variables

Create a `.env` file at the project root:

```bash
cp .env.example .env
```

Edit the `.env` file and add your credentials:

```env
API_UID=your_client_id
API_SECRET=your_client_secret
```

### 5. Start the application

#### Local mode (standard development)

```bash
npx expo start
```

Then choose your platform:
- Press `i` for iOS Simulator
- Press `a` for Android Emulator
- Scan the QR code with Expo Go (mobile)

#### Tunnel mode (42 network or restricted networks)

If you are on the 42 school network or a network with restrictions, use tunnel mode:

```bash
npx expo start --tunnel
```

**Specific configuration for tunnel:**

1. Launch the app with `npx expo start --tunnel`
2. Expo will display a URL like: `exp://abc-123.anonymous.swifty-companion.exp.direct:80`
3. Add this additional redirect URI in your 42 application:
   ```
   https://auth.expo.io/@your-username/swifty-companion
   ```
   Replace `your-username` with your Expo username (visible in the output of `npx expo start`)

**Important note:** Tunnel mode uses a tunnel service managed by Expo (similar to ngrok) to create a public URL accessible from any network. The redirect URI `https://auth.expo.io/@your-username/swifty-companion` is the standardized URL that Expo Auth Session uses to handle OAuth return in tunnel mode.

## OAuth Configuration

### Redirect URIs explained

The application uses different redirect URIs depending on the environment:

**For local development (normal network):**
- **`swiftycompanion://redirect`**: For compiled native app (iOS/Android)
- **`exp://localhost:8081/--/redirect`**: For Expo Go in local development
- **`http://localhost:8081`**: For web in development

**For development with tunnel (42 network):**
- **`https://auth.expo.io/@your-username/swifty-companion`**: For Expo Go with tunnel mode
  - Replace `your-username` with your Expo username
  - Example: `https://auth.expo.io/@johndoe/swifty-companion`

The redirect URI is automatically generated by `expo-auth-session` based on the runtime environment.

**Complete configuration in your 42 application:**

To support all environments, add all these redirect URIs in your 42 application:
```
swiftycompanion://redirect
exp://localhost:8081/--/redirect
http://localhost:8081
https://auth.expo.io/@your-username/swifty-companion
```

### App scheme

The `swiftycompanion` scheme is defined in `app.config.js`:

```javascript
scheme: "swiftycompanion"
```

This scheme allows the 42 API to redirect the user to your app after authentication.

## Project structure

```
src/
├── app/                    # Pages (file-based routing)
│   ├── (tabs)/            # Tab navigation group
│   │   ├── index.tsx      # Search page
│   │   └── logout.tsx     # Logout page
│   ├── profile/
│   │   └── [profile].tsx  # Profile detail page
│   ├── sign-in.tsx        # OAuth login page
│   └── _layout.tsx        # Main layout with authentication
├── components/            # Reusable components
│   ├── Button.tsx
│   ├── ProfileCard.tsx
│   └── SearchInput.tsx
├── contexts/              # React contexts
│   └── AuthContext.tsx    # Authentication management
├── services/              # API services
│   ├── Api42Service.ts    # Requests to 42 API
│   └── AuthService.ts     # OAuth and token management
└── types/                 # TypeScript types
    ├── api.types.ts
    └── auth.ts
```

## OAuth authentication flow

1. User clicks on "Login with 42"
2. App opens browser to `https://api.intra.42.fr/oauth/authorize`
3. User logs in with their 42 account
4. 42 redirects to `swiftycompanion://` with an authorization code
5. App exchanges the code for an `access_token` and `refresh_token`
6. Tokens are stored securely
7. User is logged in and can use the app

## Token management

- **Access Token**: Valid for 2 hours, used for API requests
- **Refresh Token**: Allows refreshing the access token without re-login
- **Secure storage**: Uses `expo-secure-store` (iOS/Android) or `localStorage` (Web)
- **Auto-refresh**: Token is automatically refreshed 5 minutes before expiration

## Technologies used

- **React Native**: Mobile framework
- **Expo**: Development platform
- **Expo Router**: File-based navigation
- **TypeScript**: Static typing
- **Axios**: HTTP client
- **expo-auth-session**: OAuth flow
- **expo-secure-store**: Secure token storage

## Development

### Linter

```bash
npm run lint
```

### TypeScript

The project uses TypeScript with strict types. Check for errors with:

```bash
npx tsc --noEmit
```

## Troubleshooting

### "Missing API configuration"

Check that your `.env` file contains `API_UID` and `API_SECRET`.

### "Redirect URI mismatch"

Make sure the redirect URI displayed in the app (in dev mode) matches those configured in your 42 application.

### Browser does not close after login

On native iOS/Android, check that the `swiftycompanion://` scheme is properly configured in your 42 application.

### Token expired

The app automatically handles token refresh. If you see this error, try logging out and logging back in.

## 42 Project

This project is part of the 42 school curriculum. It meets the following requirements:

- At least 2 views
- Error handling (login not found, network errors, etc.)
- Display login information
- At least 4 user details displayed
- Skills with level and percentage
- Completed and failed projects
- Return navigation to the first view
- Flexible/responsive layout
- No new token for each request

## License

Academic project - School 42
